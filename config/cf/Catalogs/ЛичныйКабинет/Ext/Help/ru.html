<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"><html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"></meta><link rel="stylesheet" type="text/css" href="v8help://service_book/service_style"></link><meta name="GENERATOR" content="MSHTML 11.00.10570.1001"></meta></head><body>
<h1>Личный кабинет</h1>
<p>Этот справочник предназначен для хранения информации о логике работы личного кабинета по протоколу HTTP. Доступ к личному кабинету пользователь имеет по ссылке <a href="http://адрес_сервера_1с.ru/имя_публикации/hs/lk/">http://адрес_сервера_1с.ru/имя_публикации/hs/lk/</a><br>Где <em>адрес_сервера_1с</em> - это имя сервера где установлен сервер 1С, либо HTTP-адрес сервера<br><em>имя_публикации</em> - имя под которым вы опубликовали конфигурацию.</p>
<h2>Алгоритм работы личного кабинета</h2>
<p><br>Пользователи входят в браузере по ссылке выше, вводят свой логин и пароль, попадают в личный кабинет и работают в личном кабинете, причем алгоритм работы, страницы и прочее вы можете добавить/изменить самостоятельно.<br>HTML-страницы формируются автоматически, анализируя запрос от пользователя. Т.е. если пользователь введет адрес или перейдет в личном кабинете по ссылке, например: <a href="http://адрес_сервера_1с.ru/имя_публикации/hs/lk/folder1/folder2/file.html?param=1"><font color="#0066cc">http://адрес_сервера_1с.ru/имя_публикации/hs/lk/folder1/folder2/file.html?param=1</font></a><br>То для построения страницы пользователю система выполнит следующий алгоритм:<br>Все, что после lk, т.е. /folder1/folder2/file.html?param=1 будет разбито на блоки и по шагам выполнено:</p>
<ol><li>В справочнике "Личный кабинет" будет предпринята попытка найти папку folder1 в корне справочника, далее если это путь длинный, то будет попытка найти следующую папку. 
</li><li>Путь длинный, встретили folder2 в пути, ищем внутри папки foler1 папку folder2. 
</li><li>Если папка folder2 будет найдена, то далее в этой папке будет попытке найти элемент file.html 
</li><li>Если на шагах 1-3 не будет что-то найдено, то пользователю будет показана страница с кодом 404 (страница не найдена), которая находится в разделе "Настройки" справочника "Личный кабинет" и при этом процесс будет остановлен. Если же файл будет найден в иерархии, то этот шаг игнорируется. 
</li><li>С найденным элементом на шаге 3  - если этот файл картинка, то она будет отправлена пользователю по HTTP с кодом 200 (страница найдена) и процесс остановлен, если это страница html, то возьмем текст с вкладки "Основные данные" справочника "Личный кабинет" - этот текст будет основой для будущей странички, назовем этот текст "шаблон". А текстовые данные с закладки "Алгоритм заполнения" назовем "алгоритм". 
</li><li>Берем шаблон и проверим его на наличие фрагментов вида &lt;!---include(path/to/file.html)---&gt;. Этот фрагмент означает, что необходимо вместо него вставить файл, который находится по адресу в справочнике личный кабинет "path/to/file.html". Полученный после замены текст будет новым шаблоном. 
</li><li>Берем из 
</li><li>Проверяем шаблон на то, что он содержит фрагменты текста вида &lt;!---MY_TEXT---&gt;, если такие фрагменты содержатся, то будет предпринята попытка поиска переменной на вкладке "Локализация" в настройках строки вида MY_TEXT=Это текст. Если MY_TEXT будет найдена, в настройках локализация, то вместо &lt;!---MY_TEXT---&gt; будет вставлено то, что будет указано в локализации. Полученный после замены текст будет новым шаблоном. 
</li><li>Теперь возьмем алгоритм и выполним его встроенной командой Выполнить(Алгоритм) на языке 1С. В этом алгоритме можно использовать переменные: 
<ol><li>Тело - HTML-шаблон страницы, если он не используется берется алгоритм; 
</li><li>Переменные - глобальная структура, куда могут быть помещены свои значения и использоваться при построении страниц; 
</li><li>Запрос - объект HTTP-запрос, который выполнил пользователь в браузере; 
</li><li>Ответ - ответ, который мы можем переопределить; 
</li><li>ОтносительныйURL - путь вида folder1/folder2/file.html?param=1 из примера; 
</li><li>ОтносительныйURLПеренаправления - если определить эту переменную, то вместо вывода чего-то пользователю будет дан ответ с кодом 302 (перенаправление на другу страницу) и в этой переменной указывается адрес страницы перенаправления; 
</li><li>ИмяФайла - имя файла из примера (т.е. file.html); 
</li><li>Путь - путь к файлу из примера (folder1/folder2/); 
</li><li>ЯзыковыеДанные - глобальная структура с языковыми константами; 
</li><li>POST - структура, где хранятся данные переданные через HTTP (например файлы).</li></ol></li><li>После выполнения алгоритма можем получить обновленное шаблон документа, который далее автоматически будет проанализирован. 
</li><li>Повторно проверяем шаблон на то, что он содержит фрагменты текста вида &lt;!---MY_TEXT---&gt;, которые могли быть внесены выполнение алгоритма и если такие фрагменты содержатся, то будет предпринята попытка поиска в глобальной структуре Переменные или в языковых данных в настройках строки вида MY_TEXT=Это текст. Если MY_TEXT будет найдена, то вместо &lt;!---MY_TEXT---&gt; будет вставлено то, что будет указано либо в Переменные либо в локализации. Полученный после замены текст будет готовым HTML-документом. 
</li><li>Готовый HTML-документ будет показан пользователю. Это и будет готовая страничка.</li></ol><p>Важно понимать, что если в теле HTML-документа вы добавите, например, картинку вида &lt;img src="/path/to/picture.png"&gt;, то текст будет показан, а браузер при следующем обращении увидит, что надо показать картинку и запросит у вас по пути "/path/to/picture.png" эту картинку, но это уже будет следующим запросом! Т.е. отдавать что-то другое отличное от ОтносительныйURL не надо! Это будет сделано автоматически.</p>
<p>Если вы не поняли принцип из описания, посмотрите в примеры и описания к ним в справонике. Следующие страницы делайте по аналогии, и вы поймете принцип работы.</p>
<p>Это алгоритм действий, которые будут выполнены для вывода HTML-документа пользователю и <strong>самое замечательное в этом то, что можно добавлять свои страницы и менять поведение системы в зависимости от того, что необходимо именно Вам</strong>!</p>
<h2>Свой функционал</h2>
<p>Для создания своих страниц нет никаких препятствий. Необходимо добавить страницу с какой-то информацией? Есть новости, которыми можно было бы поделиться с пользователями? Не вопрос! Добавляйте новые элементы в справочник "Личный кабинет", оформляйте логику работы, добавляйте ссылки на эти страницы в меню и пользователи будут все видеть.</p></body></html>
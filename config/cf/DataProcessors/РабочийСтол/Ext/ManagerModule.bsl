#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс	

Процедура ПолучитьДанные(Параметры, ВременноеХранилищеРезультата) Экспорт
		
	zОтвет = Новый Соответствие;
	
	мПеречисленияПланФактПлан 	= Перечисления.ПланФакт.План;
	мДатаСравнения 				= Параметры.ДатаСравнения;
	
		
	Запрос = Новый Запрос();	
	Запрос.Текст =
		"ВЫБРАТЬ
		|	Виджеты.Ссылка КАК Виджет,
		|	*
		|ИЗ
		|	Справочник.Виджеты КАК Виджеты
		|ГДЕ
		|	Виджеты.Ссылка В(&Массив)
		|
		|УПОРЯДОЧИТЬ ПО
		|	Виджеты.РеквизитДопУпорядочивания";
	Запрос.УстановитьПараметр("Массив", Параметры.МассивВиджетов);
	
	ТекстЗапроса 		= "";	
	СоответствиеВыборки = Новый Соответствие;
	
	Номер 				= 0;
	zРезультатЗапроса 	= Запрос.Выполнить();
	zВыборка 			= zРезультатЗапроса.Выбрать();
	
	Если Параметры.Свойство("ЗаВсеВремя") И Параметры.ЗаВсеВремя = Истина Тогда
		Период			= Новый Структура("ДатаНачала, ДатаОкончания", Дата(1, 1, 1), Дата(3499, 1, 1));
		
	ИначеЕсли Параметры.Свойство("ВариантСтандартногоПериода") Тогда
		Период			= ПолучитьДатыПоВариантуПериода(Параметры.ВариантСтандартногоПериода);
		
	Иначе
		Период			= Новый Структура("ДатаНачала, ДатаОкончания", Дата(1, 1, 1), Дата(3499, 1, 1));
		
	КонецЕсли;
	
	Пока zВыборка.Следующий() Цикл
		
		ДатаНачала		= Период.ДатаНачала;
		ДатаОкончания	= Период.ДатаОкончания;		

		zВиджет 		= zВыборка.Виджет;		
		НомерСтрокой 	= Формат(Номер, "ЧРД=; ЧРГ=; ЧН=0; ЧГ=");
		
		Результат 		= Неопределено;
		ОписаниеОшибки 	= "";
		Попытка
			Выполнить(zВыборка.КодОбработчикаЗначенияМетрик.Получить());		
		Исключение
			Результат = Неопределено;
			ОписаниеОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке());
		КонецПопытки;
		
		Реквизиты = Новый Соответствие;
		Для НомерКолонки = 0 По zРезультатЗапроса.Колонки.Количество() - 1 Цикл 
			Реквизиты.Вставить(zРезультатЗапроса.Колонки[НомерКолонки].Имя, zВыборка[НомерКолонки]);
		КонецЦикла;
		
		Соответствие = Новый Соответствие;
		Соответствие.Вставить("Значение", 	Результат);
		Соответствие.Вставить("Реквизиты", 	Реквизиты);
		Если НЕ ПустаяСтрока(ОписаниеОшибки) Тогда
			Соответствие.Вставить("ОписаниеОшибки", ОписаниеОшибки);
		КонецЕсли;
		zОтвет.Вставить(zВиджет, Соответствие);	

		Номер = Номер + 1;
		
	КонецЦикла;	
	ВременноеХранилищеРезультата = ПоместитьВоВременноеХранилище(zОтвет, ВременноеХранилищеРезультата);
	
КонецПроцедуры

Функция ПолучитьДатыПоВариантуПериода(Знач ВариантПериода)
	
	Если ЗначениеЗаполнено(ВариантПериода) Тогда 
		мВариантСтандартногоПериода	= МетрикиКлиентСервер.ВариантСтандартногоПериода(ВариантПериода);
		Возврат Новый СтандартныйПериод(мВариантСтандартногоПериода);
		
	Иначе
		
		Результат = Новый Структура;
		Результат.Вставить("ДатаНачала", 	Дата(1,1,1));
		Результат.Вставить("ДатаОкончания", Дата(1,1,1));
		Возврат Результат;
		
	КонецЕсли;	
	
КонецФункции

#КонецОбласти

#КонецЕсли